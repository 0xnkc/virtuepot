# VIRTUEPOT an ICS Honeypot
A high-interaction virtual ICS honeypot that simulates a PLC and provides physical process simulation.

<img src="./doc/images/VirtuePot.png" alt="ICS architecture" />

The above-mentioned diagram shows the draft copy of the architecture 


## Installation

### Prerequisites

**OS requirements**

To install Docker Engine, you need the 64-bit version of one of these Ubuntu versions:

* Ubuntu Jammy 22.04 (LTS)
* Ubuntu Impish 21.10
* Ubuntu Focal 20.04 (LTS)
* Ubuntu Bionic 18.04 (LTS)

Docker Engine is compatible with x86_64 (or amd64), armhf, arm64, and s390x architectures.

## Install Docker using the repository
1. Update the apt package index and install packages to allow apt to use a repository over HTTPS:

``` bash
sudo apt-get update
sudo apt-get install \
    ca-certificates \
    curl \
    gnupg \
    lsb-release
```


2. Add Dockerâ€™s official GPG key:

``` shell

sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
```

3. Use the following command to set up the repository:


``` bash 
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null 

```
4. Update the apt package index:
```bash
sudo apt-get update
Receiving a GPG error when running apt-get update?

#Your default umask may be incorrectly configured, preventing detection of the repository public key file. Try granting read permission for the Docker public key file before updating the package index:

sudo chmod a+r /etc/apt/keyrings/docker.gpg
sudo apt-get update
```

5. Install Docker Engine, containers, and Docker Compose.
``` bash 
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin docker-compose
```
If you got permission denied while trying to connect to the Docker daemon socket

``` bash
sudo chmod 666 /var/run/docker.sock
```

## Install [Arkime](https://github.com/arkime/arkime) on Docker 
**https://arkime.com/**

To run this image a **working OpenSearch** environment is required. Please stick to their documentation for setting this up. (E.g. for Docker: https://opensearch.org/docs/latest/opensearch/install/docker)

These parameters are available:


| ENV VARIABLE | DEFAULT VALUE |  NOTES |
| - | - | - |
| OS_HOST | opensearch | The hostname or IP address where OpenSearch is running.  |
| OS_PORT | 9200 | The port where OpenSearch is reachable. |
| ARKIME_ADMIN_PASSWORD | admin | This is the password for the Arkime admin user that is needed for the first login. It can be changed afterwards. |
| ARKIME_INTERFACE | eth0 | Network interface where `capture` process listens. **This feature is not tested yet!** |
| ARKIME_HOSTNAME | localhost | With this hostname Arkime authenticates at OpenSearch. So if you change this you'll lose your OpenSearch configuration. |
| CAPTURE | off | Set to "on" to activate the `capture` process. **This feature is not tested yet!** |
| VIEWER | on | Set to "off" to deactivate the Arkime viewer. |

| VOLUME | CONTAINER PATH | NOTES |
| - | - | - |
| config_volume | /data/config | In this directory the Arkime configuration is saved. |
| pcap_volume | /data/pcap | In this directory the pcap files are saved that are generated by `capture`. |
| log_volume | /data/logs | In this directory the Arkime log files are saved. |


### Use `docker-compose`
You can use `docker-compose` if you want to setup OpenSearch together with Arkime in one step.

#### Configuration


1. Please ensure you have done this step (otherwise OpenSearch won't start): https://opensearch.org/docs/latest/opensearch/install/docker/#important-host-settings

    To apply the setting on a live system, run:
    ``` bash
    sysctl -w vm.max_map_count=262144
    ```

2. Run `cd arkime` and `chmod -R 777 data` **OR** `chown -R 1000:1000 data`. This is needed for the OpenSearch containers to be able to write to that directory.

#### Start
Please copy or rename the file docker-compose.env to .env before run
``` bash
docker-compose up -d
```
*It can take some time until the OpenSearch instances are fully started.*

The Arkime viewer instance can be accessed via

http://localhost:8005

*Assuming you _don't _change_ the default_ port in the `.env` file.*


## Install [OpenPLC_V2](https://github.com/thiagoralves/OpenPLC_v2) on Docker 

**http://www.openplcproject.com/**

``` bash
cd OpenPLC
docker build -t openplc .
docker network create --subnet=172.25.0.0/16 mynet
#docker pull nikhilkc96/openplc
docker run -d --rm --privileged -p 8080:8080 -p 502:502 --net mynet --ip 172.25.0.5 openplc
```

## Install Mininet 
Make sure that python3 is installed as the default
``` bash 
git clone git://github.com/mininet/mininet
sudo make install
```
## Install MiniCPS
``` bash
pip3 install git+https://github.com/scy-phy/minicps
```
